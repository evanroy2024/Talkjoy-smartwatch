{% extends "base.html" %}
{% load static %}
{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<div id="mainContent" class="main-content">

<div class="bg-gray-50 min-h-screen font-sans text-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex justify-between items-center mb-8 pb-6 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-900">Analytics Dashboard</h1>
            {% if user_bots %}
            <div class="relative">
                <select class="appearance-none bg-white border border-gray-300 rounded-lg py-3 px-4 pr-10 text-sm font-medium text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" onchange="location.href='?bot_id=' + this.value">
                    <option value="">Select a Bot</option>
                    {% for bot in user_bots %}
                    <option value="{{ bot.id }}" {% if selected_bot and bot.id == selected_bot.id %}selected{% endif %}>
                        {{ bot.name }}
                    </option>
                   ="{% endfor %}
                </select>
                <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            {% endif %}
        </div>

        {% if selected_bot %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                    <h3 class="text-3xl font-bold text-gray-900">{{ analytics_data.total_messages|default:0 }}</h3>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mt-2">Total Messages</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                    <h3 class="text-3xl font-bold text-gray-900">{{ analytics_data.total_words|default:0 }}</h3>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mt-2">Total Words</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                    <h3 class="text-3xl font-bold text-gray-900">{{ analytics_data.recent_usages|default:0 }}</h3>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mt-2">Last 7 Days</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                    <h3 class="text-3xl font-bold text-gray-900">{{ analytics_data.avg_words_per_message|default:0 }}</h3>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mt-2">Avg Words/Message</p>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Global User Access</h2>
                <div class="relative w-full h-96 rounded-lg overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1562408590-2a5d7a6e44d9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80" class="slideshow-image w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-500 ease-in-out" alt="Abstract network map">
                    <img src="https://images.unsplash.com/photo-1526374965328-7f6e4d3e980f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80" class="slideshow-image w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-500 ease-in-out" alt="Digital globe visualization">
                    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80" class="slideshow-image w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-500 ease-in-out" alt="Global connectivity map">
                    <img src="https://images.unsplash.com/photo-1504608521896-82e7a4f0945e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80" class="slideshow-image w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-500 ease-in-out" alt="Network data flow">
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-900">Bot Information</h2>
                    <span class="w-3 h-3 rounded-full bg-indigo-600 ml-2"></span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm font-medium text-gray-500">Bot Name</p>
                        <p class="text-gray-900 font-medium">{{ selected_bot.name }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-500">Created</p>
                        <p class="text-gray-900 font-medium">{{ selected_bot.created_at|date:"M d, Y" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-500">Status</p>
                        <p class="text-gray-900 font-medium">Active</p>
                    </div>
                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const images = document.querySelectorAll('.slideshow-image');
                    let currentImageIndex = 0;

                    function showNextImage() {
                        images[currentImageIndex].classList.remove('opacity-100');
                        images[currentImageIndex].classList.add('opacity-0');
                        currentImageIndex = (currentImageIndex + 1) % images.length;
                        images[currentImageIndex].classList.remove('opacity-0');
                        images[currentImageIndex].classList.add('opacity-100');
                    }

                    images[currentImageIndex].classList.add('opacity-100');
                    setInterval(showNextImage, 3000);
                });
            </script>

        {% else %}
            <div class="text-center py-16">
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">No Bots Found</h2>
                <p class="text-gray-600">Create your first bot to start seeing analytics</p>
            </div>
        {% endif %}
    </div>
</div>
</div>
{% endblock content %}