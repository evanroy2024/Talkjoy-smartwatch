{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- Main Content -->
<div id="mainContent" class="main-content">

    <!-- Header -->
    <div style="border-bottom: 1px solid #e5e7eb; padding: 1rem 1.5rem; background: #ffffff;">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <h1 style="font-size: 1.2rem; font-weight: 700; color: #111827;">
                    API Key's and Credentials
                </h1>
            </div>
            <div class="flex items-center space-x-4">
                <div style="position: relative;">
                    <button onclick="openModal()" id="createBtn" style="display: flex; align-items: center; padding: 0.75rem 1rem; background: #2563eb; color: white; border: none; border-radius: 0.5rem; font-weight: 500; cursor: pointer;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Credentials
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Credentials Table -->
    <div style="margin: 2rem 1.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden;">
        <!-- Table Header -->
        <div style="display: grid; grid-template-columns: 1fr 2fr 80px; background: #f9fafb; padding: 0.75rem 1rem; font-weight: 600; color: #6b7280;">
            <div>Name</div>
            <div>API Key</div>
            <div>Action</div>
        </div>

        <!-- Table Rows -->
        {% for credential in credentials %}
        <div style="display: grid; grid-template-columns: 1fr 2fr 80px; align-items: center; padding: 0.75rem 1rem; border-top: 1px solid #e5e7eb; background: white;">
            <div>{{ credential.name }}</div>
            <div style="color: #4b5563;">{{ credential.key }}</div>
            <div>
             <form method="POST" action="{% url 'mainapp:delete_credential' credential.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this credential?');">
                    {% csrf_token %}
                    <button type="submit" title="Delete" style="background: none; border: none; color: #ef4444; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6l-1 14H6L5 6"/>
                            <path d="M10 11v6"/>
                            <path d="M14 11v6"/>
                            <path d="M9 6V4h6v2"/>
                        </svg>
                    </button>
                </form>

            </div>
        </div>
        {% empty %}
        <div style="padding: 3rem 1rem; text-align: center; color: #6b7280; font-size: 0.9rem;">
            No credentials found.
        </div>
        {% endfor %}
    </div>
</div>

<!-- MODAL -->
<div id="modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 50; justify-content: center; align-items: center;">
    <div style="background: white; border-radius: 0.5rem; width: 90%; max-width: 500px; padding: 1.5rem; position: relative;">
        <button onclick="closeModal()" style="position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #555; border: none; background: none;">&times;</button>

        <!-- Step 1: Choose Model -->
        <div id="modelSelection">
            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Choose an AI Model</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
               {% for model in models %}
<button onclick="selectModel('{{ model }}')" style="
    flex: 1 1 45%;
    padding: 0.85rem 1rem;
    background: #f9fafb;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.2s ease;
    font-size: 1rem;
    font-weight: 500;
    color: #1f2937;
" onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor='#f9fafb'">
    <div style="
        width: 36px;
        height: 36px;
        border-radius: 9999px;
        background: #e0e7ff;
        color: #4338ca;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    ">
        {{ model|first }}
    </div>
    <span>{{ model }}</span>
</button>
{% endfor %}

            </div>
        </div>

        <!-- Step 2: Form -->
        <div id="modelForm" style="display: none; margin-top: 1rem;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Selected Model: <span id="selectedModel" style="color: #2563eb;"></span></h3>
           <form method="POST" action="{% url 'mainapp:credentials' %}">
                {% csrf_token %}
                <input type="hidden" name="model" id="modelInput">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-weight: 500; margin-bottom: 0.25rem;">Credential Name</label>
                    <input name="name" required style="width: 100%; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-weight: 500; margin-bottom: 0.25rem;">API Key</label>
                    <input name="key" required style="width: 100%; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                </div>
                <button type="submit" style="padding: 0.5rem 1rem; background: #2563eb; color: white; border: none; border-radius: 0.375rem; cursor: pointer;">
                    Save Credential
                </button>
            </form>

        </div>
    </div>
</div>

<!-- Scripts -->
<script>
function openModal() {
    document.getElementById("modal").style.display = "flex";
}
function closeModal() {
    document.getElementById("modal").style.display = "none";
    document.getElementById("modelForm").style.display = "none";
    document.getElementById("modelSelection").style.display = "block";
}
function selectModel(model) {
    document.getElementById("selectedModel").textContent = model;
    document.getElementById("modelInput").value = model;
    document.getElementById("modelSelection").style.display = "none";
    document.getElementById("modelForm").style.display = "block";
}
</script>

{% endblock %}
